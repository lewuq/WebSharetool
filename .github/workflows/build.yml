name: Build Mac App

on: [push]

jobs:
  build:
    runs-on: macos-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4  # å‡çº§åˆ° v4

    - name: Set up Python
      uses: actions/setup-python@v5  # å‡çº§åˆ° v5
      with:
        python-version: '3.11'

    - name: Install Dependencies
      run: |
        pip install pyinstaller
        # pip install tk  # Macç³»ç»Ÿé€šå¸¸è‡ªå¸¦tkï¼Œå¦‚æœæŠ¥é”™ç¼ºå¤±å†å–æ¶ˆè¿™è¡Œæ³¨é‡Š

    - name: Download Cloudflared (Mac)
      run: |
        # ä¸‹è½½ Mac ç‰ˆå¼•æ“
        curl -L https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-darwin-amd64 -o cloudflared
        chmod +x cloudflared

    - name: Build with PyInstaller
      run: |
        # è¿è¡Œæ‰“åŒ…å‘½ä»¤
        # æ³¨æ„ï¼šè¿™é‡Œå‡è®¾ä½ çš„è„šæœ¬æ–‡ä»¶åå« WebShareTool.pyï¼Œè¯·æ ¹æ®å®é™…æ–‡ä»¶åä¿®æ”¹
        python3 -m PyInstaller --noconsole --windowed --onefile --name="WebShareTool_Mac" WebShareTool.py

    - name: Package for Release
      run: |
        # åˆ›å»ºå‘å¸ƒæ–‡ä»¶å¤¹
        mkdir -p Final_Mac_Build
        # ç§»åŠ¨ç”Ÿæˆçš„ .app æ–‡ä»¶ (PyInstaller é»˜è®¤ç”Ÿæˆåœ¨ dist ç›®å½•)
        mv dist/WebShareTool_Mac.app Final_Mac_Build/
        # å¤åˆ¶ cloudflared å¼•æ“è¿›å»
        cp cloudflared Final_Mac_Build/

    - name: Upload Artifact
      uses: actions/upload-artifact@v4  # ğŸ”´ å…³é”®ä¿®å¤ï¼šå‡çº§åˆ° v4
      with:
        name: Mac_Version_App
        path: Final_Mac_Build/
        compression-level: 0 # å¯é€‰ï¼šä¸å‹ç¼©ï¼Œä¸Šä¼ é€Ÿåº¦å¿«ä¸€ç‚¹
