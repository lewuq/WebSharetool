# 背景

应用工程师在撰写完wiki时，常常需要将本地运行的网页服务（如 localhost:3000）临时分享给处于不同网络环境下的小伙伴。传统的局域网 IP 分享受限于同一网段，而路由器端口映射配置繁琐。为了解决这一痛点，实现一个**零配置、跨平台、图形化**的内网穿透小工具，利用 Cloudflare Tunnel 技术生成临时公网链接，实现**一键分享**。

# 实现思路

本项目采用 **B/S 架构的本地化应用** 方案，即“Python 后端 + 浏览器前端”的模式，以确保在 Windows、macOS 和 Linux 上拥有完全一致的 UI 体验和兼容性。

核心逻辑：

- **核心引擎**：使用 Cloudflare 官方提供的 `cloudflared` 二进制文件建立安全隧道。
- **后端逻辑**：使用 **Python + Flask**。Flask 作为一个微型 Web 服务器运行在本地 `localhost:8888`，负责接收前端指令、管理后台子进程。
- **前端界面**：使用 **HTML5 + JavaScript**。提供配置界面（输入地址、时长），通过 Fetch API 与后端交互，无需安装额外的 GUI 库（如 Tkinter）。

关键技术点：

- **跨平台兼容设计**：Python脚本自动识别你所使用的系统，选择对应的执行文件
- **智能生命周期管理 (心跳机制)**：前端 JS 每 2 秒向后端 `/api/heartbeat` 发送心跳包；后端启动监控线程，一旦超过 5 秒未收到心跳（判定为网页已关闭），自动触发清理逻辑，杀掉隧道进程。
- **网络穿透稳定性**：`cloudflared` 的 metrics 监控端口使用随机数（10000-60000），避免多次运行时发生端口冲突。使用HTTP2 (TCP) 能更好地穿透 VPN。
- **傻瓜式启动脚本**：在Windows下使用 .bat 脚本执行，Mac / Linux 下使用 .sh 脚本执行

# 使用教程

本工具无需安装，解压即用。请根据您的操作系统选择对应的启动方式。

## 文件准备

确保下载的文件夹中包含以下三个文件且必须在同一目录下

1. `WebShareTool.py` (核心代码)

2. `cloudflared` 或 `cloudflared.exe` (引擎文件)

3. 启动脚本 (`Start.bat` 或  `Start.sh`)

## 配置

### Windows

1. 进入文件夹，双击运行 `Start.bat`
2. 脚本会自动检查环境
3. 启动成功后，默认浏览器会自动打开`http://localhost:8888` 的操作界面。

### Mac / Linux

1. 首次运行设置(进行完此项设置之后，以后右键打开终端直接执行文件即可)
   - 在解压的文件夹右键打开终端
   - 将Start.sh 修改为可执行文件， `sudo chmod +x Start.sh`
   - 执行脚本文件 `./Start.sh`

2. 工具会自动配置权限并打开浏览器界面。

## 操作指南

1. **填写配置**：

   - **本地地址**：默认为 `http://localhost:3000`，可修改为您实际运行的项目地址（如 `http://127.0.0.1:8080`）。

   - **有效时长**：设置链接的有效期（小时），时间到后链接自动失效。

2. **生成链接**：

   - 点击 **“🚀 立即生成分享链接”** 按钮。

   - 等待几秒，下方文本框会出现以 `trycloudflare.com` 结尾的公网链接。

3. **分享**：点击链接框全选复制，发给其他人即可访问。

4. **停止分享**：

   - **方式一**：点击网页上的 **“🛑 停止分享”** 按钮。

   - **方式二**：直接**关闭这个网页标签**，后台服务会在 5 秒内自动安全退出。
   - **方式三**：停止 yarn satrt

## 注意事项

- **VPN/代理**：虽然工具已做优化，但部分代理软件的 TUN 模式仍可能拦截流量。如果连接失败，请尝试暂时关闭 VPN 后重试，或将 `cloudflared` 加入代理软件的白名单。

- **本地服务**：在使用前，请确保您填写的“本地地址”（如 `localhost:3000`）在您自己的电脑上是可以正常访问的。
- **安全规范**：拥有此链接的用户都可以进行访问，请勿分享含未发布的内容到公开社交平台以及非公司工作场所。
- **安全规范**：拥有此生成公网链接的用户都可以进行访问，请勿分享含未发布的内容到公开社交平台以及非公司工作场所，即仅限于公司内部使用。
- **速度限制**：由于使用的是 Cloudflare 官方免费的版本，加载速度会有一定限制，比平时的网页打开会慢约 5 -10 s。
